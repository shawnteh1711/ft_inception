# Use the official debian image as the base image
FROM debian:bullseye-slim

LABEL maintainer="NGINX Docker Maintainer <fongsiongshawn@gmail.com>"

# Install necessary tools
RUN apt-get update && \
        apt-get install -yqq nginx openssl && \
            rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

# Copy default NGINX configuration
COPY ./conf/nginx.conf /etc/nginx/nginx.conf

# Copy generate ssl certificate with openssl using sh script
COPY ./tools/ssl.sh ./tmp/
RUN chmod +x ./tmp/ssl.sh

# Expose the NGINX port (default is 443)
EXPOSE 443

# ENTRYPOINT ["./tmp/ssl.sh"]
RUN	openssl req -x509 -nodes -newkey rsa:4096 -keyout /etc/nginx/ssl/schuah.key -out /etc/nginx/ssl/schuah.crt -days 365 -subj "/C=MY/ST=Selangor/L=ShahAlam/O=42KL/OU=schuah/CN=schuah"

# Start NGINX server ny passed a global configuration option to start it in foreground and
# prevent if from running as a background daemon process. This ensures that container
# remains running and does not exit immediately after starting

CMD ["nginx", "-g", "daemon off;"]

# Run ssl.sh script to generate the SSL certificate and start nginx in the foreground
# CMD ["/bin/bash", "-c", "/tmp/ssl.sh && nginx -g 'daemon off;'"]
